<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4CAF50">
    <meta name="description" content="Compare pre√ßos de produtos em diferentes supermercados">

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <title>Comparador de Pre√ßos</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --success-color: #4CAF50;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #ddd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-layout {
            display: flex;
            flex: 1;
            position: relative;
        }

        /* Sidebar Esquerdo */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        /* Carteira */
        .wallet-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .wallet-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            opacity: 0.9;
        }

        .wallet-balance {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .wallet-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .wallet-stats {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 13px;
        }

        .wallet-stat {
            flex: 1;
        }

        .wallet-stat-value {
            font-weight: bold;
            font-size: 16px;
        }

        .wallet-stat-label {
            opacity: 0.8;
            font-size: 11px;
        }

        /* Login/User Section */
        .user-section {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
        }

        .user-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .user-input-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-color);
        }

        .user-input-group input {
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }

        .user-input-group button {
            padding: 10px;
            font-size: 14px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-status {
            font-size: 12px;
            color: #666;
        }

        .btn-logout {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Menu Items */
        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-color);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.2s;
            font-size: 14px;
        }

        .menu-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(5px);
        }

        .menu-item-icon {
            font-size: 20px;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }

        .content-area.expanded {
            margin-left: 0;
        }

        /* Toggle Button */
        .sidebar-toggle {
            position: fixed;
            left: 290px;
            top: 10px;
            z-index: 999;
            background: var(--primary-color);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            font-size: 24px;
            font-weight: bold;
        }

        .sidebar-toggle:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .sidebar-toggle.sidebar-hidden {
            left: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 24px;
            text-align: center;
        }

        .search-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .search-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        button {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .supermarket-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 8px 16px;
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-chip.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            margin-top: 20px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .product-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .price {
            font-size: 28px;
            font-weight: bold;
            color: var(--success-color);
        }

        .supermarket-badge {
            display: inline-block;
            padding: 6px 12px;
            background: var(--secondary-color);
            color: white;
            border-radius: 6px;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .promo-badge {
            display: inline-block;
            padding: 4px 8px;
            background: var(--danger-color);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .product-link {
            display: inline-block;
            margin-top: 10px;
            color: var(--secondary-color);
            text-decoration: none;
            font-size: 14px;
        }

        .product-link:hover {
            text-decoration: underline;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header h1 {
                font-size: 20px;
            }

            .search-input-group {
                flex-direction: column;
            }

            .price {
                font-size: 24px;
            }

            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .content-area {
                margin-left: 0 !important;
            }

            .sidebar-toggle {
                left: 10px;
                top: 10px;
            }

            .sidebar-toggle.sidebar-hidden {
                left: 10px;
            }
        }

        .install-prompt {
            background: var(--secondary-color);
            color: white;
            padding: 15px;
            text-align: center;
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .install-prompt.show {
            display: block;
        }

        .install-prompt button {
            margin: 10px;
            background: white;
            color: var(--secondary-color);
        }

        /* Estilos para an√°lise de economia */
        .economia-info {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            border-left: 4px solid var(--success-color);
        }

        .economia-comparacao {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 13px;
            margin-top: 8px;
        }

        .economia-local {
            background: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .economia-local.melhor {
            border: 2px solid var(--success-color);
            background: #e8f5e9;
        }

        .economia-local-titulo {
            font-weight: 600;
            margin-bottom: 6px;
            color: #555;
        }

        .economia-detalhes {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .economia-linha {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }

        .economia-total {
            font-weight: bold;
            color: var(--success-color);
            padding-top: 6px;
            border-top: 1px solid #ddd;
            margin-top: 4px;
        }

        .economia-badge {
            display: inline-block;
            background: var(--success-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .info-tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: var(--secondary-color);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 6px;
        }

        .info-tooltip:hover .tooltip-content {
            display: block;
        }

        .tooltip-content {
            display: none;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
        }

        .economia-resumo {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            color: var(--success-color);
        }

        .economia-resumo.negativa {
            color: var(--danger-color);
        }

        @media (max-width: 600px) {
            .economia-comparacao {
                grid-template-columns: 1fr;
            }
        }

        /* Anima√ß√µes para notifica√ß√µes */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        ‚ò∞
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <!-- User Section -->
        <div class="user-section" id="userSection">
            <!-- Login/Register Form -->
            <div id="authForm">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button type="button" id="btnLogin" style="flex: 1; background: var(--primary-color); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Login</button>
                    <button type="button" id="btnRegistro" style="flex: 1; background: #e0e0e0; color: #333; border: 2px solid #ddd; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Registrar</button>
                </div>

                <!-- Login Form -->
                <div class="user-input-group" id="loginForm">
                    <label style="font-size: 12px;">CPF</label>
                    <input type="text" id="cpfLogin" placeholder="000.000.000-00" maxlength="14">
                    <label style="font-size: 12px;">Senha</label>
                    <input type="password" id="senhaLogin" placeholder="Digite sua senha">
                    <button type="button" id="btnEntrar">Entrar</button>
                </div>

                <!-- Register Form -->
                <div class="user-input-group" id="registerForm" style="display: none;">
                    <label style="font-size: 12px;">Nome</label>
                    <input type="text" id="nomeRegistro" placeholder="Seu nome">
                    <label style="font-size: 12px;">CPF</label>
                    <input type="text" id="cpfRegistro" placeholder="000.000.000-00" maxlength="14">
                    <label style="font-size: 12px;">Senha</label>
                    <input type="password" id="senhaRegistro" placeholder="M√≠nimo 4 caracteres">
                    <button type="button" id="btnCriarConta">Criar Conta</button>
                </div>
            </div>

            <!-- User Info (shown when logged in) -->
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <div class="user-name" id="userName"></div>
                    <div class="user-status">Conectado</div>
                </div>
                <button class="btn-logout" onclick="fazerLogout()">Sair</button>
            </div>
        </div>

        <!-- Wallet Card -->
        <div class="wallet-card" id="walletCard" style="display: none;">
            <div class="wallet-header">
                üí∞ Minha Carteira
            </div>
            <div class="wallet-balance" id="walletBalance">0</div>
            <div class="wallet-label">Tokens dispon√≠veis</div>
            <div class="wallet-stats">
                <div class="wallet-stat">
                    <div class="wallet-stat-value" id="tokensGanhos">0</div>
                    <div class="wallet-stat-label">Ganhos</div>
                </div>
                <div class="wallet-stat">
                    <div class="wallet-stat-value" id="tokensGastos">0</div>
                    <div class="wallet-stat-label">Gastos</div>
                </div>
            </div>
        </div>

        <!-- Menu Items -->
        <div class="sidebar-menu">
            <a href="#" class="menu-item" onclick="abrirConfigTransporte(); return false;">
                <span class="menu-item-icon">üöó</span>
                Combust√≠vel/Transporte
            </a>
            <a href="#" class="menu-item" onclick="mostrarCarteira(); return false;">
                <span class="menu-item-icon">üí∞</span>
                Carteira
            </a>
            <a href="/contribuicoes.html" class="menu-item">
                <span class="menu-item-icon">üë•</span>
                Ver Contribui√ß√µes
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-layout">
        <div class="content-area" id="contentArea">
            <header id="headerComparador">
                <div class="container">
                    <h1>üõí Comparador de Pre√ßos</h1>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center; flex-wrap: wrap;">
                        <a href="/contribuir.html" style="background: var(--primary-color); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: background 0.3s;" onmouseover="this.style.background='#45a049'" onmouseout="this.style.background='var(--primary-color)'">
                            ‚ûï Adicionar Pre√ßo
                        </a>
                        <a href="/scanner.html" style="background: #764ba2; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: background 0.3s;" onmouseover="this.style.background='#667eea'" onmouseout="this.style.background='#764ba2'">
                            üì∏ Escanear Nota
                        </a>
                    </div>
                </div>
            </header>

            <div class="container">
        <!-- Comparador de Pre√ßos (Padr√£o) -->
        <div id="comparadorView">
            <div class="search-box">
                <div class="search-input-group">
                    <input type="text" id="searchInput" placeholder="Digite o nome do produto (ex: arroz, feij√£o, caf√©...)">
                    <button id="searchBtn" onclick="buscarProdutos()">üîç Buscar</button>
                </div>

                <div class="supermarket-filters" id="supermarketFilters">
                    <div class="filter-chip active" data-market="all">Todos</div>
                    <div class="filter-chip" data-market="carrefour">Carrefour</div>
                    <div class="filter-chip" data-market="pao_acucar">P√£o de A√ß√∫car</div>
                    <div class="filter-chip" data-market="extra">Extra</div>
                    <div class="filter-chip" data-market="mercado_livre">Mercado Livre</div>
                    <div class="filter-chip" data-market="loja_descontos">Loja dos Descontos</div>
                </div>
            </div>

            <div class="stats" id="stats" style="display: none;">
                <div class="stat-card">
                    <div class="stat-value" id="totalProdutos">0</div>
                    <div class="stat-label">Produtos Encontrados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="melhorPreco">R$ 0,00</div>
                    <div class="stat-label">Melhor Pre√ßo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="economia">R$ 0,00</div>
                    <div class="stat-label">Economia Potencial</div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Buscando melhores pre√ßos...</p>
            </div>

            <div class="empty-state" id="emptyState">
                <p>üîç Digite um produto para come√ßar a buscar</p>
            </div>

            <div class="results" id="results"></div>
        </div>

        <!-- Carteira View (Oculto por padr√£o) -->
        <div id="carteiraView" style="display: none;">
            <div style="background: var(--card-bg); border-radius: 12px; padding: 30px; box-shadow: 0 2px 12px rgba(0,0,0,0.1);">
                <h2 style="font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üí∞ Minha Carteira
                    <button onclick="voltarComparador()" style="margin-left: auto; background: #e0e0e0; color: #333; padding: 8px 16px; font-size: 14px;">‚Üê Voltar</button>
                </h2>

                <!-- Saldo -->
                <div style="background: linear-gradient(135deg, var(--primary-color) 0%, #45a049 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 10px;">Saldo Dispon√≠vel</div>
                    <div style="font-size: 48px; font-weight: bold;" id="carteiraViewSaldo">0</div>
                    <div style="font-size: 16px; opacity: 0.9;">tokens</div>
                </div>

                <!-- Estat√≠sticas -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: var(--success-color);" id="carteiraViewGanhos">0</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">Total Ganho</div>
                    </div>
                    <div style="background: #ffebee; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: var(--danger-color);" id="carteiraViewGastos">0</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">Total Gasto</div>
                    </div>
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: var(--secondary-color);" id="carteiraViewTransacoes">0</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">Transa√ß√µes</div>
                    </div>
                </div>

                <!-- Hist√≥rico de Transa√ß√µes -->
                <div>
                    <h3 style="font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        üìú Hist√≥rico de Transa√ß√µes
                    </h3>
                    <div id="carteiraHistorico" style="max-height: 400px; overflow-y: auto;">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Como ganhar tokens -->
                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h4 style="font-size: 16px; margin-bottom: 10px;">üí° Como ganhar tokens?</h4>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li><strong>+10 tokens</strong> - Adicionar pre√ßo de produto</li>
                        <li><strong>+10 tokens</strong> - Escanear nota fiscal (por produto)</li>
                        <li><strong>+5 tokens</strong> - B√¥nus de cadastro (apenas uma vez)</li>
                    </ul>
                    <h4 style="font-size: 16px; margin: 15px 0 10px 0;">üí∏ Como gastar tokens?</h4>
                    <ul style="margin-left: 20px; line-height: 2;">
                        <li><strong>-1 token</strong> - Buscar produtos</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="install-prompt" id="installPrompt">
        <p>üì± Instalar o app na tela inicial?</p>
        <button onclick="instalarApp()">Instalar</button>
        <button onclick="fecharInstall()">Agora n√£o</button>
    </div>
        </div>
    </div>

    <script src="/src/app.js"></script>
    <script>
        // N√£o redeclarar API_URL - j√° existe no app.js
        const API_URL_AUTH = 'http://localhost:8000/api';
        let usuarioAtual = localStorage.getItem('usuario_nome') || null;

        // Toggle Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const contentArea = document.getElementById('contentArea');
            const toggleBtn = document.getElementById('sidebarToggle');

            sidebar.classList.toggle('hidden');
            contentArea.classList.toggle('expanded');
            toggleBtn.classList.toggle('sidebar-hidden');
        }

        // Mostrar formul√°rios
        function mostrarLogin() {
            console.log('Mostrando formul√°rio de login');
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('btnLogin').style.background = 'var(--primary-color)';
            document.getElementById('btnLogin').style.color = 'white';
            document.getElementById('btnLogin').style.border = 'none';
            document.getElementById('btnRegistro').style.background = '#e0e0e0';
            document.getElementById('btnRegistro').style.color = '#333';
            document.getElementById('btnRegistro').style.border = '2px solid #ddd';
        }

        function mostrarRegistro() {
            console.log('Mostrando formul√°rio de registro');
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'flex';
            document.getElementById('btnRegistro').style.background = 'var(--primary-color)';
            document.getElementById('btnRegistro').style.color = 'white';
            document.getElementById('btnRegistro').style.border = 'none';
            document.getElementById('btnLogin').style.background = '#e0e0e0';
            document.getElementById('btnLogin').style.color = '#333';
            document.getElementById('btnLogin').style.border = '2px solid #ddd';
        }

        // Formatar CPF
        function formatarCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            input.value = value;
        }

        // Login
        async function fazerLogin() {
            const cpf = document.getElementById('cpfLogin').value.replace(/\D/g, '');
            const senha = document.getElementById('senhaLogin').value;

            if (cpf.length !== 11) {
                alert('Digite um CPF v√°lido');
                return;
            }

            if (!senha || senha.length < 4) {
                alert('Digite sua senha');
                return;
            }

            try {
                const response = await fetch(`${API_URL_AUTH}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cpf, senha })
                });

                const data = await response.json();

                if (data.sucesso) {
                    usuarioAtual = data.usuario_nome;
                    localStorage.setItem('usuario_nome', data.usuario_nome);
                    localStorage.setItem('cpf', cpf);
                    mostrarUsuarioLogado();
                    await atualizarCarteira();
                } else {
                    alert(data.mensagem);
                }
            } catch (error) {
                console.error('Erro ao fazer login:', error);
                alert('Erro ao conectar com o servidor');
            }
        }

        // Registrar
        async function fazerRegistro() {
            const nome = document.getElementById('nomeRegistro').value.trim();
            const cpf = document.getElementById('cpfRegistro').value.replace(/\D/g, '');
            const senha = document.getElementById('senhaRegistro').value;

            if (!nome || nome.length < 3) {
                alert('Digite um nome v√°lido (m√≠nimo 3 caracteres)');
                return;
            }

            if (cpf.length !== 11) {
                alert('Digite um CPF v√°lido');
                return;
            }

            if (!senha || senha.length < 4) {
                alert('Senha deve ter pelo menos 4 caracteres');
                return;
            }

            try {
                const response = await fetch(`${API_URL_AUTH}/auth/registrar?usuario_nome=${encodeURIComponent(nome)}&cpf=${cpf}&senha=${encodeURIComponent(senha)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.sucesso) {
                    alert('‚úÖ Conta criada com sucesso! Voc√™ ganhou 5 tokens de b√¥nus!');
                    usuarioAtual = data.usuario_nome;
                    localStorage.setItem('usuario_nome', data.usuario_nome);
                    localStorage.setItem('cpf', cpf);
                    mostrarUsuarioLogado();
                    await atualizarCarteira();
                } else {
                    alert(data.mensagem);
                }
            } catch (error) {
                console.error('Erro ao registrar:', error);
                alert('Erro ao conectar com o servidor');
            }
        }

        // Logout
        function fazerLogout() {
            usuarioAtual = null;
            localStorage.removeItem('usuario_nome');
            localStorage.removeItem('cpf');
            mostrarFormularioLogin();
            document.getElementById('walletCard').style.display = 'none';
        }

        // Mostrar usu√°rio logado
        function mostrarUsuarioLogado() {
            document.getElementById('authForm').style.display = 'none';
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('userName').textContent = usuarioAtual;
            document.getElementById('userAvatar').textContent = usuarioAtual[0].toUpperCase();
            document.getElementById('walletCard').style.display = 'block';
        }

        // Mostrar formul√°rio de login
        function mostrarFormularioLogin() {
            document.getElementById('authForm').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            mostrarLogin();
        }

        // Atualizar carteira
        async function atualizarCarteira() {
            if (!usuarioAtual) return;

            try {
                const response = await fetch(`${API_URL_AUTH}/carteira/${usuarioAtual}`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('walletBalance').textContent = Math.floor(data.saldo);
                    document.getElementById('tokensGanhos').textContent = Math.floor(data.total_minerado);
                    document.getElementById('tokensGastos').textContent = Math.floor(data.total_gasto);
                }
            } catch (error) {
                console.error('Erro ao atualizar carteira:', error);
            }
        }

        // Mostrar carteira (nova view)
        async function mostrarCarteira() {
            if (!usuarioAtual) {
                alert('Fa√ßa login para acessar sua carteira');
                return;
            }

            // Esconder header e comparador, mostrar carteira
            document.getElementById('headerComparador').style.display = 'none';
            document.getElementById('comparadorView').style.display = 'none';
            document.getElementById('carteiraView').style.display = 'block';

            // Carregar dados da carteira
            await carregarDadosCarteira();
        }

        // Voltar para o comparador
        function voltarComparador() {
            document.getElementById('headerComparador').style.display = 'block';
            document.getElementById('carteiraView').style.display = 'none';
            document.getElementById('comparadorView').style.display = 'block';
        }

        // Carregar dados da carteira
        async function carregarDadosCarteira() {
            if (!usuarioAtual) return;

            try {
                // Buscar saldo e estat√≠sticas
                const responseCarteira = await fetch(`${API_URL_AUTH}/carteira/${usuarioAtual}`);
                if (responseCarteira.ok) {
                    const data = await responseCarteira.json();

                    // Atualizar saldo e estat√≠sticas
                    document.getElementById('carteiraViewSaldo').textContent = Math.floor(data.saldo);
                    document.getElementById('carteiraViewGanhos').textContent = Math.floor(data.total_minerado);
                    document.getElementById('carteiraViewGastos').textContent = Math.floor(data.total_gasto);
                    document.getElementById('carteiraViewTransacoes').textContent = data.total_transacoes;
                }

                // Buscar hist√≥rico
                const responseHistorico = await fetch(`${API_URL_AUTH}/carteira/${usuarioAtual}/historico`);
                if (responseHistorico.ok) {
                    const transacoes = await responseHistorico.json();

                    const historicoDiv = document.getElementById('carteiraHistorico');

                    if (transacoes.length === 0) {
                        historicoDiv.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Nenhuma transa√ß√£o ainda</p>';
                    } else {
                        let html = '';
                        transacoes.forEach(t => {
                            const data = new Date(t.data_transacao).toLocaleString('pt-BR');
                            const valor = t.quantidade > 0 ? `+${t.quantidade}` : t.quantidade;
                            const cor = t.quantidade > 0 ? '#4CAF50' : '#f44336';
                            const bgCor = t.quantidade > 0 ? '#e8f5e9' : '#ffebee';

                            html += `
                                <div style="background: ${bgCor}; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid ${cor};">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong style="color: ${cor}; font-size: 18px;">${valor} tokens</strong>
                                            <div style="color: #666; font-size: 14px; margin-top: 5px;">${t.descricao || t.tipo}</div>
                                        </div>
                                        <div style="text-align: right; font-size: 12px; color: #999;">
                                            ${data}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        historicoDiv.innerHTML = html;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar dados da carteira:', error);
                alert('Erro ao carregar dados da carteira');
            }
        }

        // Configurar tudo quando a p√°gina carregar
        window.addEventListener('load', () => {
            console.log('=== P√°gina carregada - Iniciando configura√ß√£o ===');

            // Configurar formata√ß√£o CPF
            const cpfInputs = document.querySelectorAll('#cpfLogin, #cpfRegistro');
            cpfInputs.forEach(input => {
                input.addEventListener('input', () => formatarCPF(input));
            });
            console.log('Formata√ß√£o CPF configurada');

            // Configurar bot√£o Login
            const btnLogin = document.getElementById('btnLogin');
            if (btnLogin) {
                btnLogin.onclick = function() {
                    console.log('>>> Clicou em Login');
                    mostrarLogin();
                };
                console.log('‚úÖ Bot√£o Login configurado');
            }

            // Configurar bot√£o Registrar
            const btnRegistro = document.getElementById('btnRegistro');
            if (btnRegistro) {
                btnRegistro.onclick = function() {
                    console.log('>>> Clicou em Registrar');
                    mostrarRegistro();
                };
                console.log('‚úÖ Bot√£o Registrar configurado');
            }

            // Configurar bot√£o Entrar
            const btnEntrar = document.getElementById('btnEntrar');
            if (btnEntrar) {
                btnEntrar.onclick = function() {
                    console.log('>>> Clicou em Entrar');
                    fazerLogin();
                };
                console.log('‚úÖ Bot√£o Entrar configurado');
            }

            // Configurar bot√£o Criar Conta
            const btnCriarConta = document.getElementById('btnCriarConta');
            if (btnCriarConta) {
                btnCriarConta.onclick = function() {
                    console.log('>>> Clicou em Criar Conta');
                    fazerRegistro();
                };
                console.log('‚úÖ Bot√£o Criar Conta configurado');
            }

            // Verificar sess√£o
            const cpfSalvo = localStorage.getItem('cpf');
            if (usuarioAtual && !cpfSalvo) {
                console.log('Usu√°rio antigo sem CPF - fazendo logout');
                fazerLogout();
                return;
            }

            if (usuarioAtual) {
                console.log('Usu√°rio logado:', usuarioAtual);
                mostrarUsuarioLogado();
                atualizarCarteira();
            } else {
                console.log('Nenhum usu√°rio logado - mostrando formul√°rio de login');
                mostrarFormularioLogin();
            }

            console.log('=== Configura√ß√£o conclu√≠da ===');
        });

        // Atualizar carteira a cada 30 segundos
        setInterval(() => {
            if (usuarioAtual) {
                atualizarCarteira();
            }
        }, 30000);

        // ============================================
        // CONFIGURA√á√ÉO DE TRANSPORTE
        // ============================================

        window.abrirConfigTransporte = function() {
            const modal = document.getElementById('modalTransporte');
            if (!modal) {
                window.criarModalTransporte();
            }
            document.getElementById('modalTransporte').style.display = 'flex';

            // Carregar configura√ß√£o salva
            const config = JSON.parse(localStorage.getItem('configTransporte') || '{"tipo":"carro","considerar_tempo":true}');
            document.querySelector('input[name="tipoTransporte"][value="' + config.tipo + '"]').checked = true;
            document.getElementById('considerarTempo').checked = config.considerar_tempo;

            window.atualizarInfoTransporte(config.tipo);
        }

        window.criarModalTransporte = function() {
            const modal = document.createElement('div');
            modal.id = 'modalTransporte';
            modal.style.cssText = 'display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center; padding: 20px;';

            modal.innerHTML = '<div style="background: white; border-radius: 12px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">' +
                '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">' +
                    '<h2 style="margin: 0; color: #333;">üöó Combust√≠vel/Transporte</h2>' +
                    '<button onclick="window.fecharModalTransporte()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">&times;</button>' +
                '</div>' +
                '<p style="color: #666; margin-bottom: 25px; font-size: 14px;">' +
                    'Configure seu tipo de transporte para c√°lculos mais precisos de economia considerando o custo de deslocamento.' +
                '</p>' +
                '<div style="margin-bottom: 25px;">' +
                    '<label style="display: block; margin-bottom: 15px; font-weight: 600; color: #333;">Tipo de Transporte:</label>' +
                    '<label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;" class="transport-option" data-tipo="carro">' +
                        '<input type="radio" name="tipoTransporte" value="carro" style="margin-right: 12px;" onchange="window.atualizarInfoTransporte(\'carro\')">' +
                        '<div style="flex: 1;">' +
                            '<div style="font-weight: 600;">üöó Carro</div>' +
                            '<small style="color: #666;">R$ 0,80/km (combust√≠vel + desgaste)</small>' +
                        '</div>' +
                    '</label>' +
                    '<label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;" class="transport-option" data-tipo="moto">' +
                        '<input type="radio" name="tipoTransporte" value="moto" style="margin-right: 12px;" onchange="window.atualizarInfoTransporte(\'moto\')">' +
                        '<div style="flex: 1;">' +
                            '<div style="font-weight: 600;">üèçÔ∏è Moto</div>' +
                            '<small style="color: #666;">R$ 0,35/km (mais econ√¥mico)</small>' +
                        '</div>' +
                    '</label>' +
                    '<label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;" class="transport-option" data-tipo="onibus">' +
                        '<input type="radio" name="tipoTransporte" value="onibus" style="margin-right: 12px;" onchange="window.atualizarInfoTransporte(\'onibus\')">' +
                        '<div style="flex: 1;">' +
                            '<div style="font-weight: 600;">üöå √înibus</div>' +
                            '<small style="color: #666;">R$ 0,25/km (transporte p√∫blico)</small>' +
                        '</div>' +
                    '</label>' +
                    '<label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;" class="transport-option" data-tipo="ape">' +
                        '<input type="radio" name="tipoTransporte" value="ape" style="margin-right: 12px;" onchange="window.atualizarInfoTransporte(\'ape\')">' +
                        '<div style="flex: 1;">' +
                            '<div style="font-weight: 600;">üö∂ A p√©</div>' +
                            '<small style="color: #666;">R$ 0,00/km (gr√°tis!)</small>' +
                        '</div>' +
                    '</label>' +
                '</div>' +
                '<div style="margin-bottom: 25px;">' +
                    '<label style="display: flex; align-items: center; cursor: pointer;">' +
                        '<input type="checkbox" id="considerarTempo" style="margin-right: 10px;">' +
                        '<span style="font-size: 14px; color: #333;">Considerar valor do tempo (R$ 15/hora)</span>' +
                    '</label>' +
                    '<small style="color: #666; margin-left: 24px; display: block; margin-top: 5px;">' +
                        'Inclui o custo do seu tempo no deslocamento' +
                    '</small>' +
                '</div>' +
                '<div id="infoTransporte" style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>' +
                '<div style="display: flex; gap: 10px;">' +
                    '<button onclick="window.salvarConfigTransporte()" style="flex: 1; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; border: none; padding: 14px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">' +
                        'Salvar Configura√ß√£o' +
                    '</button>' +
                    '<button onclick="window.fecharModalTransporte()" style="flex: 1; background: #f5f5f5; color: #333; border: none; padding: 14px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">' +
                        'Cancelar' +
                    '</button>' +
                '</div>' +
            '</div>';

            document.body.appendChild(modal);

            // Estilo para op√ß√£o selecionada
            const style = document.createElement('style');
            style.textContent = '.transport-option:has(input:checked) { border-color: #4CAF50 !important; background: #f1f8f4 !important; } .transport-option:hover { border-color: #4CAF50 !important; }';
            document.head.appendChild(style);
        }

        window.atualizarInfoTransporte = function(tipo) {
            const info = {
                carro: {
                    emoji: 'üöó',
                    nome: 'Carro',
                    custo: '0,80',
                    exemplo: 'Loja a 10km = R$ 16,00 (ida e volta)'
                },
                moto: {
                    emoji: 'üèçÔ∏è',
                    nome: 'Moto',
                    custo: '0,35',
                    exemplo: 'Loja a 10km = R$ 7,00 (ida e volta)'
                },
                onibus: {
                    emoji: 'üöå',
                    nome: '√înibus',
                    custo: '0,25',
                    exemplo: 'Loja a 10km = R$ 5,00 (ida e volta)'
                },
                ape: {
                    emoji: 'üö∂',
                    nome: 'A p√©',
                    custo: '0,00',
                    exemplo: 'Loja a 10km = R$ 0,00 (mas leva ~3h30min!)'
                }
            };

            const dados = info[tipo];
            const infoDiv = document.getElementById('infoTransporte');

            infoDiv.innerHTML = '<div style="text-align: center;">' +
                '<div style="font-size: 48px; margin-bottom: 10px;">' + dados.emoji + '</div>' +
                '<div style="font-weight: 600; font-size: 18px; margin-bottom: 5px;">' + dados.nome + '</div>' +
                '<div style="color: #666; margin-bottom: 10px;">Custo: R$ ' + dados.custo + ' por km</div>' +
                '<div style="font-size: 13px; color: #4CAF50; background: white; padding: 10px; border-radius: 6px;">' +
                'üìç Exemplo: ' + dados.exemplo +
                '</div></div>';
        }

        window.salvarConfigTransporte = function() {
            const tipo = document.querySelector('input[name="tipoTransporte"]:checked').value;
            const considerarTempo = document.getElementById('considerarTempo').checked;

            const config = {
                tipo: tipo,
                considerar_tempo: considerarTempo
            };

            localStorage.setItem('configTransporte', JSON.stringify(config));

            // Mostrar mensagem de sucesso
            const infoDiv = document.getElementById('infoTransporte');
            infoDiv.innerHTML = '<div style="text-align: center; color: #4CAF50; font-weight: 600;">‚úÖ Configura√ß√£o salva com sucesso!</div>';

            setTimeout(() => {
                fecharModalTransporte();
            }, 1500);
        }

        window.fecharModalTransporte = function() {
            document.getElementById('modalTransporte').style.display = 'none';
        }

    </script>
</body>
</html>
